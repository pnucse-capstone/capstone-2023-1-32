# **WI-SUN FAN 네트워크를 활용한 스마트 공유 주차장**

# 1. 프로젝트 소개

자동차는 대부분의 시간을 주차장에서 보내고, 운전자는 주행 시간의 30% 이상을 주차 공간을 찾는데 쓴다는 연구 결과가 있습니다.

이런 문제를 해결하기 위해서 빈 주차장을 다른 사람들과 공유하는 '공유 주차장'이라는 개념이 있습니다. 

하지만, 기존의 여러 공유 주차장 서비스들이 있었음에도 불구하고, '부정 주차 문제'로 인한 한계점이 명확했습니다. 

저희는 '부정 주차 문제'를 해결하고자 차단기가 부착된 공유 주차장 모듈을 제작하였습니다.

이를 활용해 Internet of Things 기반의 공유 주차장 솔루션을 제시하고 주차 비효율 문제를 해결하는데 도움을 주고자 합니다.

# 2. 팀 소개

- 정우영
- 이창주
- 홍유준

# 3. 구성도

- 아래의 그림은 전체적인 서비스의 구조도를 나타내는 그림입니다.
![서비스 전체 구조도](./docs/files/structure.jpg)
- Application - Server: Firebase의 FireStore를 Application Server로 활용
- AP(AccessPoint): AP에서는 python을 활용하여 Firestore Document의 eventListener를 등록해 Application과 Communication
- AP - WI-SUN Root Module: AP에 연결된 

# 4. 소개 및 시연 영상
[시연 영상](https://youtube.com/)

# 5. 사용법

이 프로젝트에 사용된 Wi-SUN 모듈의 경우, 기술적 권리로 인해 배포 및 공개가 금지되어 있습니다.

따라서, 해당 모듈과 관련된 source code 및 사용법은 이 repository 및 README에 포함하지 않았습니다.

## 5.1 주차장 모듈

주차 공간 소유자가 자신의 주차 공간을 운전자에게 공유하고자 할 때, 관련 기능을 제공할 수 있는 주차장 모듈을 개발한다.

아래의 기능을 모두 하나의 모듈로 구현해서 간단하게 설치할 수 있는 형태로 모듈을 제작했다. 

아래 이미지는 주차장 모듈의 실제 모습이다.

![모듈 구조도](./docs/files/module_real_1.png)

![모듈 구조도](./docs/files/module_real_2.png)

위의 주차장 모듈은 주차면에 차량이 주차되어 있는지 여부를 실시간으로 파악해야 한다. 

그러한 역할을 수행하기 위해서 초음파 센서로 지속적으로 값을 측정해서 서버로 전송해주고, 해당 정보를 사용자 애플리케이션을 통해서 사용자에게 보여주는 기능이 필요하다.

차량의 주차 여부는 초음파 센서를 활용해 판단한다. 초음파 센서는 0cm~200cm 사이의 값을 측정해서 50cm 이하인 경우 주차가 되었다고 판단하고 그 외의 값이면 주차가 되어있지 않았다고 판단한다. 

주차가 되어 있으면 1, 주차가 되어있지 않으면 0을 전송한다. 

측정된 초음파 센서 값을 UART 통신을 통해 Wi-SUN 모듈로 전송하고 루트 모듈로 전달한다.

![아두이노와 wisun 모듈](./docs/files/arduino%20and%20wisun%20module.png)

주차장 모듈에 부정 주차를 방지할 수 있는 차단바 기능을 구현했다. 

해당 기능은 아두이노 우노 보드에 연결되어 있는 서보 모터를 통하여 구현하였고, 전원을 공급하기 위해서 PCA9680 모터 드라이버 모듈을 사용했다.

차단바의 움직임은 사용자가 애플리케이션을 통해서 제어한다. 

사용자가 차단바를 제어하는 값을 Wi-SUN 모듈이 송신받으면 UART 통신을 통해 아두이노 우도 보드에 전송하고, 그 값에 따라서 서보 모터를 움직여 차단바를 제어한다.

![모터 드라이버와 서보모터](./docs/files/motor%20driver%20and%20servo%20motor.png)


우리 공유 주차장 시스템은 Wi-SUN FAN 네트워크를 이용하여 통신한다. 

각각의 주차장 모듈은 네트워크 상에서 하나의 노드로 생각할 수 있다. 

Wi-SUN FAN 네트워크를 이용한 통신을 간략히 요약하면 다음과 같다.
- Wi-SUN FAN 네트워크의 모든 패킷은 루트 노드를 경유한다.
- 루트 노드를 관찰하는 옵저버를 둔다.
- 옵저버는 Wi-SUN 모듈과 서버 사이의 패킷을 중간에서 연결하는 역할을 수행한다.


## 5.2 Observer


## 5.3 Android


## 5.4 Casing(H/W)

케이싱은 주차장 모듈에 필요한 센서와 보드들이 모두 안전하게 보관 및 동작할 수 있도록 모델링을 진행하였다. 

차단바를 움직이는데 필요한 서보모터의 구동축은 바깥에서 보이도록 하였고, WI-SUN 모듈의 안테나도 외부에서 장착할 수 있도록 제작했다.

